<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>HomePort: HomePort API Specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HomePort
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">HomePort API Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec_internal_arch">Internal architecture</a></li>
<li class="level1"><a href="#sec_data_mode">HomePort data model</a><ul><li class="level2"><a href="#sec_error_handling">Enumerations for error handling</a></li>
<li class="level2"><a href="#sec_attrs">Attribute default keys</a></li>
<li class="level2"><a href="#sec_methods">Method and Port enumeration</a></li>
<li class="level2"><a href="#sec_custom_data">Custom user data and free functions</a></li>
</ul>
</li>
<li class="level1"><a href="#sec_shared_api">Shared API (Adapters and Applications) - Part I</a><ul><li class="level2"><a href="#sec_modules">Modules</a></li>
<li class="level2"><a href="#sec_logging">Logging</a></li>
<li class="level2"><a href="#sec_indirect_refs">Indirect references</a></li>
</ul>
</li>
<li class="level1"><a href="#sec_adapter_api">Adapter API</a><ul><li class="level2"><a href="#sec_hpd_adapter_t">Adapter structure (hpd_adapter_t)</a></li>
<li class="level2"><a href="#sec_hpd_device_t">Device structure (hpd_device_t)</a></li>
<li class="level2"><a href="#sec_hpd_service_t">Service structure (hpd_service_t)</a></li>
<li class="level2"><a href="#sec_hpd_parameter_t">Parameter structure (hpd_parameter_t)</a></li>
</ul>
</li>
<li class="level1"><a href="#sec_shared_api_cont">Shared API (Adapters and Applications) - Part II</a><ul><li class="level2"><a href="#sec_data_model_get">Data model getters</a></li>
<li class="level2"><a href="#sec_data_model_nav">Data model navigation</a></li>
</ul>
</li>
<li class="level1"><a href="#sec_comm">Communication</a><ul><li class="level2"><a href="#sec_value">Shared API - Value structure</a></li>
<li class="level2"><a href="#sec_adapter_comm">Adapter API - Communication</a></li>
<li class="level2"><a href="#sec_application_api">Application API - Communication</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sec_internal_arch"></a>
Internal architecture</h1>
<ul>
<li>Data Model:<ul>
<li><a class="el" href="a00018.html">model.h</a></li>
</ul>
</li>
<li>Communication Model:<ul>
<li><a class="el" href="a00033.html">comm.h</a></li>
</ul>
</li>
<li>Daemon Service:<ul>
<li><a class="el" href="a00076.html">daemon.c</a></li>
<li><a class="el" href="a00017.html">daemon.h</a></li>
<li><a class="el" href="a00077.html">daemon_api.c</a></li>
</ul>
</li>
<li>Discovery Service:<ul>
<li><a class="el" href="a00078.html">discovery.c</a></li>
<li><a class="el" href="a00020.html">discovery.h</a></li>
<li><a class="el" href="a00079.html">discovery_api.c</a></li>
<li><a class="el" href="a00080.html">discovery_id.c</a></li>
</ul>
</li>
<li>Event Dispatch Service:<ul>
<li><a class="el" href="a00081.html">event.c</a></li>
<li><a class="el" href="a00082.html">event.h</a></li>
<li><a class="el" href="a00083.html">event_api.c</a></li>
</ul>
</li>
<li>Log Dispatch Service:<ul>
<li><a class="el" href="a00084.html">log.c</a></li>
<li><a class="el" href="a00085.html">log.h</a></li>
<li><a class="el" href="a00086.html">log_api.c</a></li>
</ul>
</li>
<li>Request Dispatch Service:<ul>
<li><a class="el" href="a00087.html">request.c</a></li>
<li><a class="el" href="a00088.html">request.h</a></li>
<li><a class="el" href="a00089.html">request_api.c</a></li>
</ul>
</li>
<li>Value Service:<ul>
<li><a class="el" href="a00090.html">value.c</a></li>
<li><a class="el" href="a00091.html">value.h</a></li>
<li><a class="el" href="a00092.html">value_api.c</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="sec_data_mode"></a>
HomePort data model</h1>
<p>The internal class diagram for reference, most but not all types are available to the outside through references (direct access to members are generally not possible):</p>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_2.svg"></object>
<div class="caption">
Class diagram (Probably outdated)</div>
</div>
<h2><a class="anchor" id="sec_error_handling"></a>
Enumerations for error handling</h2>
<p>All functions in the API returns hpd_err_t, which is: </p><dl class="todo"><dt><b><a class="el" href="a00100.html#_todo000001">Todo:</a></b></dt><dd>Should really reconsider whether to have errors on free functions - really difficult to handle (there's a reason you're not suppose to throw in destructors!)</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0d">hpd_error</a> {</div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da4daeb92d8a8f80fa07ea5909d5efd940">HPD_E_SUCCESS</a> = 0,  <span class="comment">//&lt; The operation was successful.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da2f79bfa65b655d022e4c712ea08b05ef">HPD_E_UNKNOWN</a> = 1,  <span class="comment">//&lt; An unknown error</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da3e44c22b887a9371a8cf59644c2ea182">HPD_E_NULL</a>,         <span class="comment">//&lt; Null pointer error.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da74be3b084dd73433942c30fe6b4dc37a">HPD_E_ALLOC</a>,        <span class="comment">//&lt; Memory allocation error.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0dad314ace10a0f6198ba4007008d63af6c">HPD_E_STATE</a>,        <span class="comment">//&lt; An object is in an invalid state.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da4de1dbcac975eac38ddbde99d9b5f1fe">HPD_E_ARGUMENT</a>,     <span class="comment">//&lt; An argument is invalid.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da982739b885433cf1ae5f01874534cd5f">HPD_E_NOT_UNIQUE</a>,   <span class="comment">//&lt; An argument is not unique.</span></div>
<div class="line">    <a class="code" href="a00030.html#af2d90ea316126f626dd4bcd587cdfb0da3856d98f8e3b56ef9a5e8c8b5d7cdfb5">HPD_E_NOT_FOUND</a>,    <span class="comment">//&lt; The object could not be found.</span></div>
<div class="line">};</div>
</div><!-- fragment --><p> For the request-response relationships HomePort continues to use HTTP status codes to describe errors, as many modules relies on HTTP connections. From the HTTP protocol, these are:</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define HPD_HTTP_STATUS_CODE_MAP(XX) \</span></div>
<div class="line"><span class="preprocessor">    XX(100, Continue) \</span></div>
<div class="line"><span class="preprocessor">    XX(101, Switching Protocols) \</span></div>
<div class="line"><span class="preprocessor">    XX(200, OK) \</span></div>
<div class="line"><span class="preprocessor">    XX(201, Created) \</span></div>
<div class="line"><span class="preprocessor">    XX(202, Accepted) \</span></div>
<div class="line"><span class="preprocessor">    XX(203, Non-Authoritative Information) \</span></div>
<div class="line"><span class="preprocessor">    XX(204, No Content) \</span></div>
<div class="line"><span class="preprocessor">    XX(205, Reset Content) \</span></div>
<div class="line"><span class="preprocessor">    XX(206, Partial Content) \</span></div>
<div class="line"><span class="preprocessor">    XX(300, Multiple Choices) \</span></div>
<div class="line"><span class="preprocessor">    XX(301, Moved Permanently) \</span></div>
<div class="line"><span class="preprocessor">    XX(302, Found) \</span></div>
<div class="line"><span class="preprocessor">    XX(303, See Other) \</span></div>
<div class="line"><span class="preprocessor">    XX(304, Not Modified) \</span></div>
<div class="line"><span class="preprocessor">    XX(305, Use Proxy) \</span></div>
<div class="line"><span class="preprocessor">    XX(306, (Unused)) \</span></div>
<div class="line"><span class="preprocessor">    XX(307, Temporary Redirect) \</span></div>
<div class="line"><span class="preprocessor">    XX(400, Bad Request) \</span></div>
<div class="line"><span class="preprocessor">    XX(401, Unauthorized) \</span></div>
<div class="line"><span class="preprocessor">    XX(402, Payment Required) \</span></div>
<div class="line"><span class="preprocessor">    XX(403, Forbidden) \</span></div>
<div class="line"><span class="preprocessor">    XX(404, Not Found) \</span></div>
<div class="line"><span class="preprocessor">    XX(405, Method Not Allowed) \</span></div>
<div class="line"><span class="preprocessor">    XX(406, Not Acceptable) \</span></div>
<div class="line"><span class="preprocessor">    XX(407, Proxy Authentication Required) \</span></div>
<div class="line"><span class="preprocessor">    XX(408, Request Timeout) \</span></div>
<div class="line"><span class="preprocessor">    XX(409, Conflict) \</span></div>
<div class="line"><span class="preprocessor">    XX(410, Gone) \</span></div>
<div class="line"><span class="preprocessor">    XX(411, Length Required) \</span></div>
<div class="line"><span class="preprocessor">    XX(412, Precondition Failed) \</span></div>
<div class="line"><span class="preprocessor">    XX(413, Request Entity Too Large) \</span></div>
<div class="line"><span class="preprocessor">    XX(414, Request-URI Too Long) \</span></div>
<div class="line"><span class="preprocessor">    XX(415, Unsupported Media Type) \</span></div>
<div class="line"><span class="preprocessor">    XX(416, Requested Range Not Satisfiable) \</span></div>
<div class="line"><span class="preprocessor">    XX(417, Expectation Failed) \</span></div>
<div class="line"><span class="preprocessor">    XX(500, Internal Server Error) \</span></div>
<div class="line"><span class="preprocessor">    XX(501, Not Implemented) \</span></div>
<div class="line"><span class="preprocessor">    XX(502, Bad Gateway) \</span></div>
<div class="line"><span class="preprocessor">    XX(503, Service Unavailable) \</span></div>
<div class="line"><span class="preprocessor">    XX(504, Gateway Timeout) \</span></div>
<div class="line"><span class="preprocessor">    XX(505, HTTP Version Not Supported)</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> <a class="code" href="a00030.html#ae4a225ffa1d7c54da791fd9109d8b026">hpd_status</a> {</div>
<div class="line">    <a class="code" href="a00030.html#ae4a225ffa1d7c54da791fd9109d8b026ae721ddf4e6ed5344ca7c8eb2d8c76ec1">HPD_S_NONE</a> = 0,</div>
<div class="line"><span class="preprocessor">#define XX(num, str) HPD_S_##num = num,</span></div>
<div class="line">    <a class="code" href="a00030.html#af6a35195aed41ee7ef7387765e48eae9">HPD_HTTP_STATUS_CODE_MAP</a>(<a class="code" href="a00026.html#ad3a6c0d2c0459b52d11d4abe39beec21">XX</a>)</div>
<div class="line"><span class="preprocessor">#undef XX</span></div>
<div class="line">};</div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_attrs"></a>
Attribute default keys</h2>
<p>The entities in the data model are described using attributes. These are flexible key-value pairs, where the keys can be chosen freely. However, we do define the following default keys for consistencies between modules: </p><dl class="todo"><dt><b><a class="el" href="a00100.html#_todo000002">Todo:</a></b></dt><dd>As with default keys, we could add default values as well; Type = Temperature, Unit = C, etc. Seluxit and Zigbee can be used for inspiration (Rene’s work).</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#afd063bef22bfdb7b0ad41f08b4861716">HPD_ATTR_NETWORK</a>  = <span class="stringliteral">&quot;network&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a540d22cb78f555a5f25b21ab607683be">HPD_ATTR_DESC</a>     = <span class="stringliteral">&quot;description&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#accc5260134fba19813d32c7fbe3b5b1c">HPD_ATTR_NAME</a>     = <span class="stringliteral">&quot;name&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#ac948ba8992ec0a52b645f60d9b230097">HPD_ATTR_VENDOR</a>   = <span class="stringliteral">&quot;vendor&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a2afb0aa6d46cf4601b73d8d08d6aea71">HPD_ATTR_PRODUCT</a>  = <span class="stringliteral">&quot;product&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a78daad1c7f876af6943bb6fe340f5c50">HPD_ATTR_VERSION</a>  = <span class="stringliteral">&quot;version&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#ab67af0a442b049e45daeb2d2af7271dd">HPD_ATTR_LOCATION</a> = <span class="stringliteral">&quot;location&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#aff4150f68e4fc6506adc361a2620b8fc">HPD_ATTR_TYPE</a>     = <span class="stringliteral">&quot;type&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a652841436839645120dbff5d24a8eecf">HPD_ATTR_UNIT</a>     = <span class="stringliteral">&quot;unit&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#ae2401d47fd4f87fff5953edab5075157">HPD_ATTR_MAX</a>      = <span class="stringliteral">&quot;max&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#addb02685571b0901d347a0b35146a0c2">HPD_ATTR_MIN</a>      = <span class="stringliteral">&quot;min&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#ab6c6b8c13398bb014aec754799c6bb57">HPD_ATTR_STEP</a>     = <span class="stringliteral">&quot;step&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a646f1a37ce12164a5460cdcc92e9ed42">HPD_ATTR_SCALE</a>    = <span class="stringliteral">&quot;scale&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a113290a892b3db5ebfa7f118b5728096">HPD_ATTR_VALUES</a>   = <span class="stringliteral">&quot;values&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="a00030.html#a36b4cdb8060258ac029d6c44e02860f0">HPD_ATTR_PROTOCOL</a>   = <span class="stringliteral">&quot;protocol&quot;</span>;</div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_methods"></a>
Method and Port enumeration</h2>
<p>Services have a set of actions, currently for get and put only, but these are define in a enumeration, thus can easily be expanded later:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="a00030.html#ae5973cb13ba680422f6381e98b783dd1">hpd_method</a> {</div>
<div class="line">    <a class="code" href="a00030.html#ae5973cb13ba680422f6381e98b783dd1a2c38a7f6fd4aea028bccace7aa2e5df4">HPD_M_NONE</a> = -1, <span class="comment">//&lt; Method that does not exist, must be first below valid methods</span></div>
<div class="line">    <a class="code" href="a00030.html#ae5973cb13ba680422f6381e98b783dd1a4aa1b1492e9715dc6214b6ebf1fa21f0">HPD_M_GET</a> = 0,   <span class="comment">//&lt; HTTP GET like method</span></div>
<div class="line">    <a class="code" href="a00030.html#ae5973cb13ba680422f6381e98b783dd1abb3582c2747d9760897062694fa369a5">HPD_M_PUT</a>,       <span class="comment">//&lt; HTTP PUT like method</span></div>
<div class="line">    <a class="code" href="a00030.html#ae5973cb13ba680422f6381e98b783dd1aa248a39ea7ed1f64d1b3fc38009c1924">HPD_M_COUNT</a>      <span class="comment">//&lt; Last</span></div>
<div class="line">};</div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_custom_data"></a>
Custom user data and free functions</h2>
<p>HomePort's data model allow module developers to store custom pointers to user data of their own choice. HomePort will not touch this data. To allow memory management of custom data pointers, HomePort generally take a on_free callback function with the data pointer. This function will be called when HomePort is free'ing the object and can be used by the module developer to ensure that the custom data is free'd as well. The function pointer can be NULL, if it is not necessary to free the data.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>); <span class="comment">//&lt; Free function, used to free user supplied data.</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="sec_main"></a>
Main Program</h1>
<div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00074.html#a3d879947af1cc338c9bb9cf68fcce672">hpd_alloc</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> **hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00074.html#aa833627ad45d82173c0caf687cd30126">hpd_free</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00074.html#a1360e4af1219978973e0afd4486c489e">hpd_module</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="a00030.html#a00123">hpd_module_def_t</a> *module_def);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00074.html#a4a5e670df4a5790a7955aaef5483c08a">hpd_start</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00074.html#ad279f4f771e132927c09bd599fbe2b1b">hpd_stop</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd);</div>
</div><!-- fragment --><p> First, the main program allocates memory for HomePort (hpd_t) with <a class="el" href="a00074.html#a3d879947af1cc338c9bb9cf68fcce672" title="[hpd_t functions] ">hpd_alloc()</a>. Then it tells HomePort of all modules that it wishes to include with <a class="el" href="a00074.html#a1360e4af1219978973e0afd4486c489e">hpd_module()</a>. We shall use the term module for both adapters and applications. All modules are assigned a unique id by the main program, which allows running multiple instances of the same module. module_def is a public structure, of which each module should provide an instance (explained below).</p>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_3.svg"></object>
<div class="caption">
Main program</div>
</div>
<p>The main program will then start HomePort with <a class="el" href="a00074.html#a4a5e670df4a5790a7955aaef5483c08a">hpd_start()</a>. Note that this function does not return, but will keep running until <a class="el" href="a00074.html#ad279f4f771e132927c09bd599fbe2b1b">hpd_stop()</a> is called. <a class="el" href="a00074.html#ad279f4f771e132927c09bd599fbe2b1b">hpd_stop()</a> will be called automatically on sigint and sigterm. Finally, the main program will deallocate the memory with <a class="el" href="a00074.html#aa833627ad45d82173c0caf687cd30126">hpd_free()</a>.</p>
<p>Any pointer to hpd_t is valid between calls to <a class="el" href="a00074.html#a3d879947af1cc338c9bb9cf68fcce672" title="[hpd_t functions] ">hpd_alloc()</a> and <a class="el" href="a00074.html#aa833627ad45d82173c0caf687cd30126">hpd_free()</a>, and thus can generally be stored by modules in their entire lifetime.</p>
<h1><a class="anchor" id="sec_shared_api"></a>
Shared API (Adapters and Applications) - Part I</h1>
<h2><a class="anchor" id="sec_modules"></a>
Modules</h2>
<p>A module will provide an instance of the module_def structure along with implementations of the five included functions. module_def is a structure where the members are publicly available.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="a00030.html#a00123">hpd_module_def</a> {</div>
<div class="line">    <a class="code" href="a00030.html#a2e932ff646412a220b4459bdf5e6429e">hpd_create_f</a> <a class="code" href="a00030.html#ac5e987b98f2cb8f414920c7e7d254e31">on_create</a>;</div>
<div class="line">    <a class="code" href="a00030.html#a206271176a15bb48166e0e5059d2e21f">hpd_destroy_f</a> <a class="code" href="a00030.html#a6f33b1825d892dadab69abc2d95d9c54">on_destroy</a>;</div>
<div class="line">    <a class="code" href="a00030.html#a3235cf0b8166f4a875daac55f5892766">hpd_start_f</a> <a class="code" href="a00030.html#ab49d3704883a41920340d4bc8f9dff13">on_start</a>;</div>
<div class="line">    <a class="code" href="a00030.html#a609e923b2efa9d44a8450c815b2bbc74">hpd_stop_f</a> <a class="code" href="a00030.html#afc46e3a02a31aa7c392901b395d2e882">on_stop</a>;</div>
<div class="line">    <a class="code" href="a00030.html#ad154f5de88f915a61a45ab0a08cb1d03">hpd_parse_opt_f</a> <a class="code" href="a00030.html#a6df5927a6ae5bea30b4f1f44898d3cb8">on_parse_opt</a>; <span class="comment">//&lt; Should return HPD_E_ARGUMENT if name is not known</span></div>
<div class="line">};</div>
</div><!-- fragment --><p> The five functions: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> (*<a class="code" href="a00030.html#a2e932ff646412a220b4459bdf5e6429e">hpd_create_f</a>)    (<span class="keywordtype">void</span> **<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <span class="keyword">const</span> <a class="code" href="a00029.html">hpd_module_t</a> *context);</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> (*<a class="code" href="a00030.html#a206271176a15bb48166e0e5059d2e21f">hpd_destroy_f</a>)   (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>);</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> (*<a class="code" href="a00030.html#a3235cf0b8166f4a875daac55f5892766">hpd_start_f</a>)     (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd);</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> (*<a class="code" href="a00030.html#a609e923b2efa9d44a8450c815b2bbc74">hpd_stop_f</a>)      (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd);</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> (*<a class="code" href="a00030.html#ad154f5de88f915a61a45ab0a08cb1d03">hpd_parse_opt_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *arg);</div>
</div><!-- fragment --><p> In here, on_create and on_destroy are used to allocate/deallocate globally available memory in data, which can be used freely. on_start and on_stop are used to initialise/stop the underlying connection and add watchers to the event loop – whatever is required for the module to be considered running. To handle program argument given to the executable, a module can also define on_parse_opt, which may be called between on_create and on_start due to arguments given to the executable.</p>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_4.svg"></object>
<div class="caption">
Module functions and object lifetime</div>
</div>
<p>The following three functions are shared between adapters and applications: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ae5288c3d07fdd00ff0b0a03f2d26961f">hpd_module_add_option</a>(<span class="keyword">const</span> <a class="code" href="a00029.html">hpd_module_t</a> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *arg, <span class="keywordtype">int</span> flags,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *doc);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a22c32e717ccc176ad124a3ebcc1c9e7b">hpd_module_get_id</a>(<span class="keyword">const</span> <a class="code" href="a00029.html">hpd_module_t</a> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#abb80916ac5990db56afd0fc309949f4c">hpd_get_loop</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <a class="code" href="a00030.html#a8b9d6b16dbb9ccaf08497a11cc0b1d29">hpd_ev_loop_t</a> **<a class="code" href="a00052.html#a855923b555731173d3509ecb645de0e0">loop</a>);</div>
</div><!-- fragment --><p> For arguments to work, the module will have to add any options using <a class="el" href="a00075.html#ae5288c3d07fdd00ff0b0a03f2d26961f" title="[hpd_t functions] ">hpd_module_add_option()</a> during on_create. Options will be named &ndash;id-name, where id is the module identifier, as given by the main program. The module can call <a class="el" href="a00075.html#a22c32e717ccc176ad124a3ebcc1c9e7b">hpd_module_get_id()</a> to obtain this id. During on_start and afterwards, the event loop will be accessible through <a class="el" href="a00075.html#abb80916ac5990db56afd0fc309949f4c">hpd_get_loop()</a>. On here, the module can put io-watchers, timer-watchers, and more to trigger on events.</p>
<p>A module can rely on the pointer to its hpd_module_t (as given in <a class="el" href="a00039.html#a297aa16bc7c7dcdadf2462323ec703f5">on_create()</a>) will be valid for its entire lifetime, that is between calls to on_create and on_destroy. The pointer to its id (as obtained with <a class="el" href="a00075.html#a22c32e717ccc176ad124a3ebcc1c9e7b">hpd_module_get_id()</a>) is valid in the same interval. The pointer to the event loop (as obtained with <a class="el" href="a00075.html#abb80916ac5990db56afd0fc309949f4c">hpd_get_loop()</a>) is valid between calls to on_start and on_stop.</p>
<h2><a class="anchor" id="sec_logging"></a>
Logging</h2>
<div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2">hpd_log_level</a> {</div>
<div class="line">    <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2ab809c83c0fac1decee6f5fa93faaa32c">HPD_L_ERROR</a>,</div>
<div class="line">    <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2a27b5aeeb31289b21e4c73f79c983a33a">HPD_L_WARN</a>,</div>
<div class="line">    <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2a46e3ea561c3d8cae140943f98754cfbf">HPD_L_INFO</a>,</div>
<div class="line">    <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2aeb426717209696ae37bb52aa0487326f">HPD_L_DEBUG</a>,</div>
<div class="line">    <a class="code" href="a00030.html#aa89d79ab2946861491c24c5a0868f6c2abe65ad03e9a9c73a69619f994f71e345">HPD_L_VERBOSE</a>,</div>
<div class="line">};</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ab8839a02d4595ab53f44129b1ce87552">hpd_logf</a>(<span class="keyword">const</span> <a class="code" href="a00029.html">hpd_module_t</a> *context, <a class="code" href="a00030.html#afc656721774fec3607cb4a1f4c658469">hpd_log_level_t</a> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a97e67bb70ed2df56642f2e9a8b5cd9f8">hpd_vlogf</a>(<span class="keyword">const</span> <a class="code" href="a00029.html">hpd_module_t</a> *context, <a class="code" href="a00030.html#afc656721774fec3607cb4a1f4c658469">hpd_log_level_t</a> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, va_list vp);</div>
<div class="line"><span class="preprocessor">#define HPD_LOG_ERROR(CONTEXT, FMT, ...) hpd_logf((CONTEXT), HPD_L_ERROR, __FILE__, __LINE__, (FMT), ##__VA_ARGS__)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_WARN(CONTEXT, FMT, ...) hpd_logf((CONTEXT), HPD_L_WARN , __FILE__, __LINE__, (FMT), ##__VA_ARGS__)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_INFO(CONTEXT, FMT, ...) hpd_logf((CONTEXT), HPD_L_INFO , __FILE__, __LINE__, (FMT), ##__VA_ARGS__)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_DEBUG(CONTEXT, FMT, ...) hpd_logf((CONTEXT), HPD_L_DEBUG, __FILE__, __LINE__, (FMT), ##__VA_ARGS__)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_VERBOSE(CONTEXT, FMT, ...) hpd_logf((CONTEXT), HPD_L_VERBOSE, __FILE__, __LINE__, (FMT), ##__VA_ARGS__)</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_RETURN(CONTEXT, E, FMT, ...) do { HPD_LOG_DEBUG((CONTEXT), (FMT), ##__VA_ARGS__); return (E); } while(0)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_RETURN_E_NULL(CONTEXT)  HPD_LOG_RETURN((CONTEXT), HPD_E_NULL,  &quot;Unexpected null pointer.&quot;)</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_RETURN_E_ALLOC(CONTEXT) HPD_LOG_RETURN((CONTEXT), HPD_E_ALLOC, &quot;Unable to allocate memory.&quot;)</span></div>
<div class="line"><span class="comment">// TODO New function, check if it can be used elsewhere</span></div>
<div class="line"><span class="preprocessor">#define HPD_LOG_RETURN_E_SNPRINTF(CONTEXT) HPD_LOG_RETURN((CONTEXT), HPD_E_UNKNOWN, &quot;snprintf failed.&quot;)</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_indirect_refs"></a>
Indirect references</h2>
<p>Through the following sections we shall utilise indirect references to objects in the data mode (adapters, devices, services, parameters). These prevent module developers from keeping pointers to objects that eventually will be free'd, thus making these pointers invalid. To allocate and free these references:</p>
<div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aaf24eefdbdf2debbf530eb19db96bd86">hpd_adapter_id_alloc</a>(<a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **<span class="keywordtype">id</span>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keyword">const</span> <span class="keywordtype">char</span> *aid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aadb695833d05d754f6c240200556e3ba">hpd_adapter_id_copy</a>(<a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **dst, <span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *src);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a6dfca5e2723ca3a11d12fe545e69923e">hpd_adapter_id_free</a>(<a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>);</div>
<div class="line"></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a990c7b89fc6040ae81d835df174980d4">hpd_device_id_alloc</a>(<a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **<span class="keywordtype">id</span>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keyword">const</span> <span class="keywordtype">char</span> *aid, <span class="keyword">const</span> <span class="keywordtype">char</span> *did);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aa259433e48cac2f450d3869a1626ba99">hpd_device_id_copy</a>(<a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **dst, <span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *src);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a9a00d602f27e6ec01adf931e9daaeb42">hpd_device_id_free</a>(<a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>);</div>
<div class="line"></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#adcfc7ced2dccafaac60ca13f700061d5">hpd_service_id_alloc</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **<span class="keywordtype">id</span>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keyword">const</span> <span class="keywordtype">char</span> *aid, <span class="keyword">const</span> <span class="keywordtype">char</span> *did, <span class="keyword">const</span> <span class="keywordtype">char</span> *sid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a209bc0d87372338816b0fb5c30a57663">hpd_service_id_copy</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **dst, <span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *src);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a19ce779c8a8a82fcb624cd7631eaee20">hpd_service_id_free</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>);</div>
<div class="line"></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ac1e2289044cde6f0f992588a434fa891">hpd_parameter_id_alloc</a>(<a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> **<span class="keywordtype">id</span>, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <span class="keyword">const</span> <span class="keywordtype">char</span> *aid, <span class="keyword">const</span> <span class="keywordtype">char</span> *did, <span class="keyword">const</span> <span class="keywordtype">char</span> *sid, <span class="keyword">const</span> <span class="keywordtype">char</span> *pid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ab38acf0351e304f00700cc9ccd9443bd">hpd_parameter_id_copy</a>(<a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> **dst, <span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *src);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a672ca4a557b724d795853002ea453429">hpd_parameter_id_free</a>(<a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *<span class="keywordtype">id</span>);</div>
</div><!-- fragment --><p> If a module developers explicitly call *_id_alloc(), they are also responsible for calling *_id_free().</p>
<h1><a class="anchor" id="sec_adapter_api"></a>
Adapter API</h1>
<p>The functions in the Adapter API are only available for adapters.</p>
<h2><a class="anchor" id="sec_hpd_adapter_t"></a>
Adapter structure (hpd_adapter_t)</h2>
<p>To maintain adapter structures in the data model: </p><dl class="todo"><dt><b><a class="el" href="a00100.html#_todo000003">Todo:</a></b></dt><dd>Maybe change name of the structure from “adapter” to “network” to highlight the differences between modules and adapters. A module can make multiple networks of devices.</dd></dl>
<div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#aec51fa5c17a707a90a1634358ae1a9b4">hpd_adapter_alloc</a>(<a class="code" href="a00019.html">hpd_adapter_t</a> **adapter, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a0a2b0d9eef603396a0171d5b0c67bbbf">hpd_adapter_free</a>(<a class="code" href="a00019.html">hpd_adapter_t</a> *adapter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a247f5a01789cd6bd85a2f1238d36c29c">hpd_adapter_attach</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <a class="code" href="a00019.html">hpd_adapter_t</a> *adapter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a66c7a7a288fb2be658fcab815bd274e2">hpd_adapter_detach</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00019.html">hpd_adapter_t</a> **adapter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ae4435821a3fd887ed393c05dacd2a79d">hpd_adapter_set_data</a>(<a class="code" href="a00019.html">hpd_adapter_t</a> *adapter, <span class="keywordtype">void</span> *data, <a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a> on_free);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a0d5ca643908e5c921d763ad9f5c9ba8e">hpd_adapter_set_attr</a>(<a class="code" href="a00019.html">hpd_adapter_t</a> *adapter, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a0dc61e22d6abc5a621e53cd3aab2f9ca">hpd_adapter_set_attrs</a>(<a class="code" href="a00019.html">hpd_adapter_t</a> *adapter, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a4921d2583e0c244e30b2ef7cc96ecd9f">hpd_adapter_get_data</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, <span class="keywordtype">void</span> **data);</div>
</div><!-- fragment --><p> alloc/free are used to manage memory. attach/detach are used to hand the object to HomePort. If an object is attached, it will be visibly through the navigation functions (shown later) and HomePort will ensure that the memory is managed. For example this means that if an adapter is freed, all devices, services, etc. below it will automatically be freed also. Note that the reverse applies too; if an object is detached, HomePort do not know about it and it is up to the module to manage the memory. set_data/get_data functions can be used, by the adapter, to store custom data within HomePort. If on_free is set, HomePort will call this function to free this custom data, when the object is freed.</p>
<p>As to when to use a direct pointer to the adapter and when to use an indirect reference, see the following diagram. <a class="el" href="a00071.html#aec51fa5c17a707a90a1634358ae1a9b4" title="[hpd_adapter_t functions] ">hpd_adapter_alloc()</a> allocates the instance of hpd_adapter_t, which is referred to using a pointer - the module developer is in control of the memory. The object is changed (set functions), and finally <a class="el" href="a00071.html#a247f5a01789cd6bd85a2f1238d36c29c">hpd_adapter_attach()</a> is called. After this call the pointer <em>will</em> be invalid and we can only refer to the object using instances of hpd_adapter_id_t (indirect references) - HomePort manages the memory.</p>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_5.svg"></object>
<div class="caption">
Lifetime of adapter structures (Outside view, not exact implementation)</div>
</div>
<p>After a call to <a class="el" href="a00071.html#a66c7a7a288fb2be658fcab815bd274e2">hpd_adapter_detach()</a>, the indirect reference will still be allocated, but will now result in HPD_E_NOT_FOUND, if we try to use it. <a class="el" href="a00071.html#a66c7a7a288fb2be658fcab815bd274e2">hpd_adapter_detach()</a> also returns a pointer to hpd_adapter_t &ndash; it is now the responsibility of the module to free the object.</p>
<dl class="section user"><dt>Implementation details:</dt><dd><a class="el" href="a00071.html#a247f5a01789cd6bd85a2f1238d36c29c">hpd_adapter_attach()</a> will make a copy of hpd_adapter_t, thus effectively invalidating the pointer. <a class="el" href="a00071.html#a66c7a7a288fb2be658fcab815bd274e2">hpd_adapter_detach()</a> will return a pointer to this copy, which was stored in the internal data model.</dd></dl>
<h2><a class="anchor" id="sec_hpd_device_t"></a>
Device structure (hpd_device_t)</h2>
<p>Devices are managed in a similar manner: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a10a4b84cc7128e1900008dc1de4653a2">hpd_device_alloc</a>(<a class="code" href="a00022.html">hpd_device_t</a> **device, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a7b20f2cfe2e46cdbfe4112b95922446b">hpd_device_free</a>(<a class="code" href="a00022.html">hpd_device_t</a> *device);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a8ecd575d81e054bd4296e55f2f36b126">hpd_device_attach</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00022.html">hpd_device_t</a> *device);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ab8bd71524a42feb4064a3f3787e455e7">hpd_device_detach</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00022.html">hpd_device_t</a> **device);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a082d6cbdcf9bc2051d3372e9275b7c9f">hpd_device_set_data</a>(<a class="code" href="a00022.html">hpd_device_t</a> *device, <span class="keywordtype">void</span> *data, <a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a> on_free);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#aa52044afe11425f0febeba4f6094e48f">hpd_device_set_attr</a>(<a class="code" href="a00022.html">hpd_device_t</a> *device, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a79a100958212cd7d8be053ceeb15885c">hpd_device_set_attrs</a>(<a class="code" href="a00022.html">hpd_device_t</a> *device, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#aaf8828edb31e4538b5ad631cd4db5ea0">hpd_device_get_data</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>, <span class="keywordtype">void</span> **data);</div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_hpd_service_t"></a>
Service structure (hpd_service_t)</h2>
<p>Services furthermore allow setting an action, which is a method and a function pointer. Currently only get and put is support, but it could theoretically be expanded to others: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ae265c33796304a96d8a0e670e61e7a3a">hpd_service_alloc</a>(<a class="code" href="a00035.html">hpd_service_t</a> **service, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#acebc47c8796cb46b14899df696fae147">hpd_service_free</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#af441be40a9cec089a7bd655e5b7bc61c">hpd_service_attach</a>(<a class="code" href="a00022.html">hpd_device_t</a> *device, <a class="code" href="a00035.html">hpd_service_t</a> *service);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a8f6bfcd6776fd1cad2d0b8c2445808be">hpd_service_detach</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00035.html">hpd_service_t</a> **service);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a3974326e212a829eef3dc2a4f554ccf0">hpd_service_set_data</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, <span class="keywordtype">void</span> *data, <a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a> on_free);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ad7f06997cb2f69f3decb671a16d2bdb6">hpd_service_set_attr</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a436b38305c5c560b7c2d78285ac7e27c">hpd_service_set_attrs</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a66883e77bc53793b588c5768621c477e">hpd_service_set_action</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, <span class="keyword">const</span> <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> method, <a class="code" href="a00030.html#a3f3da4470fa4c995abf27b874d142c97">hpd_action_f</a> action);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a8a4f9edb085f44b1eb5d9b31447f06c9">hpd_service_set_actions</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#af2e67426a85ae7dbca39b4676e799377">hpd_service_get_data</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <span class="keywordtype">void</span> **data);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">typedef</span> <a class="code" href="a00030.html#a60424f5506ab8db09a11ee78f2f980e6">hpd_status_t</a> (*<a class="code" href="a00030.html#a3f3da4470fa4c995abf27b874d142c97">hpd_action_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <a class="code" href="a00033.html#a00126">hpd_request_t</a> *req); <span class="comment">//&lt; Action function for handling requests on services.</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_hpd_parameter_t"></a>
Parameter structure (hpd_parameter_t)</h2>
<p>Finally, functions to manage parameters: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a510d8b9b58d0cf4d661e7e433004ca10">hpd_parameter_alloc</a>(<a class="code" href="a00032.html">hpd_parameter_t</a> **parameter, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ad8c6360b9faf931207a84a045e44b858">hpd_parameter_free</a>(<a class="code" href="a00032.html">hpd_parameter_t</a> *parameter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#add11419bd4fd209882bbe83c8ce8442a">hpd_parameter_attach</a>(<a class="code" href="a00035.html">hpd_service_t</a> *service, <a class="code" href="a00032.html">hpd_parameter_t</a> *parameter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a12a15d2285c617a05506a1d534b7bfba">hpd_parameter_detach</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00032.html">hpd_parameter_t</a> **parameter);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#ac80954392c6e6b03259a057603784b9b">hpd_parameter_set_attr</a>(<a class="code" href="a00032.html">hpd_parameter_t</a> *parameter, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a386bb8668e01dfbc4a11b3c3d65eb92a">hpd_parameter_set_attrs</a>(<a class="code" href="a00032.html">hpd_parameter_t</a> *parameter, ...);</div>
</div><!-- fragment --> <h1><a class="anchor" id="sec_shared_api_cont"></a>
Shared API (Adapters and Applications) - Part II</h1>
<h2><a class="anchor" id="sec_data_model_get"></a>
Data model getters</h2>
<p>To get members from the objects, created by an adapter, applications have the following functions: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#afd02a1458a4f43210ef9ad2ca1cd92b2">hpd_adapter_get_id</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *aid, <span class="keyword">const</span> <span class="keywordtype">char</span> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a8db1cd92ffd5366df9d753960db5beb6">hpd_adapter_get_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a7233fef8ef53ea9e03f0dd216cd37df4">hpd_adapter_get_attrs</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a6c4218a3f07341c85f9e56a0a98e4c4a">hpd_adapter_first_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aec6ad8ba587691d915dad6fd44a1893d">hpd_adapter_next_attr</a>(<a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a7d1ad44eb960013e7af0d33f8fed3f6b">hpd_device_get_id</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *did, <span class="keyword">const</span> <span class="keywordtype">char</span> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ae50c2d338d437c388c945bd22e21fa0a">hpd_device_get_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a307c74e13eedc87aae5fb47248799362">hpd_device_get_attrs</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a7c6f17c790c91caed57dd00721d66b58">hpd_device_first_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aef33fa285b4906fba1427686e7d8b59d">hpd_device_next_attr</a>(<a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a5537ebbc8e732a33b7cf084b86b61a4e">hpd_service_get_id</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *sid, <span class="keyword">const</span> <span class="keywordtype">char</span> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ad94a25ca7e08d839189d8264b33ca5f6">hpd_service_get_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a7e351af570bc7f24a68510a4d3d5e8c7">hpd_service_get_attrs</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a455f4c7dbccfb14aa4238fd069b1f5d1">hpd_service_has_action</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> method, <a class="code" href="a00030.html#aa552386fb82302e070499d850b2e8ca9">hpd_bool_t</a> *<span class="keywordtype">boolean</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ac453f37f763367957f2fa097e008569a">hpd_service_first_action</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00018.html#a00111">hpd_action_t</a> **action);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a33a3466581f29468601bc805c630ac9e">hpd_service_next_action</a>(<a class="code" href="a00018.html#a00111">hpd_action_t</a> **action);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a09246e3dc3453b6c9085e3011bf00f38">hpd_service_first_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a1185afdc4beec2949203e66a370a94bf">hpd_service_next_attr</a>(<a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a40fef652549700bdbd8050b2e0023722">hpd_parameter_get_id</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *pid, <span class="keyword">const</span> <span class="keywordtype">char</span> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aaf85643448f499a89f33e9fa419f87c2">hpd_parameter_get_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ab7346d9e5a437ded6e5f3b838ffe46e6">hpd_parameter_get_attrs</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *<span class="keywordtype">id</span>, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a329ec544bfeca977682e3e2b4566f4dd">hpd_parameter_first_attr</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ac62276ecb4feccf4e9760adc33739620">hpd_parameter_next_attr</a>(<a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a7a562b3767c599041b288d9aeb5cf487">hpd_action_get_method</a>(<span class="keyword">const</span> <a class="code" href="a00018.html#a00111">hpd_action_t</a> *action, <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> *method);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00056.html#a234fa0db60fda58722702273bf7e82a2">hpd_pair_get</a>(<span class="keyword">const</span> <a class="code" href="a00031.html#a00124">hpd_pair_t</a> *pair, <span class="keyword">const</span> <span class="keywordtype">char</span> **<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **value);</div>
</div><!-- fragment --><p> Again, we have defines to ease foreach loops: </p><div class="fragment"><div class="line"><span class="preprocessor">#define hpd_service_foreach_action(RC, ACTION, ID) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_first_action((ID), &amp;(ACTION)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (ACTION); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_next_action(&amp;(ACTION)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_adapter_foreach_attr(RC, PAIR, ID) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_first_attr((ID), &amp;(PAIR)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PAIR); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_next_attr(&amp;(PAIR)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_device_foreach_attr(RC, PAIR, ID) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_device_first_attr((ID), &amp;(PAIR)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PAIR); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_device_next_attr(&amp;(PAIR)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_service_foreach_attr(RC, PAIR, ID) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_first_attr((ID), &amp;(PAIR)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PAIR); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_next_attr(&amp;(PAIR)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_parameter_foreach_attr(RC, PAIR, ID) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_parameter_first_attr((ID), &amp;(PAIR)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PAIR); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_parameter_next_attr(&amp;(PAIR)))</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_data_model_nav"></a>
Data model navigation</h2>
<p>The HomePort data model can be navigated by both adapters and applications, thus only the later will find use for browsing through models created by another module. To do so, the following functions are available: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#adfb3b93b2371a7c5671bd90f4ced2dcd">hpd_adapter_get_hpd</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *aid, <a class="code" href="a00017.html#a00110">hpd_t</a> **hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ab22aa54002682adc963cde53ebf09f56">hpd_device_get_hpd</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *did, <a class="code" href="a00017.html#a00110">hpd_t</a> **hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a50b0521e638f13c35f0d7f4860d8064d">hpd_device_get_adapter</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *did, <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **aid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ae34dfb9354053574f4b87677f15bb26b">hpd_service_get_hpd</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *sid, <a class="code" href="a00017.html#a00110">hpd_t</a> **hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a43dfdac4b9fea4a35e2709a22778250e">hpd_service_get_adapter</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *sid, <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **aid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a73e474ba372ed4e985f1f3cb186c3e0b">hpd_service_get_device</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *sid, <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **did);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ad64d7dd81dca25e123bef2625eac53c2">hpd_parameter_get_hpd</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *pid, <a class="code" href="a00017.html#a00110">hpd_t</a> **hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a63a138dc6d530f46e5babb509d329155">hpd_parameter_get_adapter</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *pid, <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **aid);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aadf61544da511e800cd725fe915fc07e">hpd_parameter_get_device</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *pid, <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **did);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a2bcdc07fb44a41d8b3d36c1ef6d004a5">hpd_parameter_get_service</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> *pid, <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **sid);</div>
<div class="line"></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a35bf26228e2c725f300412ef59eecf4b">hpd_first_adapter</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **adapter_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ad992dfa91c033da312b4c34d32607fbd">hpd_first_device</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **device_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ad8e76c9feefa648fbca586e7d7421501">hpd_first_service</a>(<a class="code" href="a00017.html#a00110">hpd_t</a> *hpd, <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a297022470f758c6077ca2b0975c09c81">hpd_adapter_first_device</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *adapter_id, <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **device_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a0d2aa3aac7e683442687b104839bf813">hpd_adapter_first_service</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> *adapter_id, <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a532ad51864602ea42cd8c9ca6aabe189">hpd_device_first_service</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *device_id, <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a2b22cb2106adec77c580dafd75902efa">hpd_service_first_parameter</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *service_id, <a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> **parameter_id);</div>
<div class="line"></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a460c1d013092f65b4bf7d7ece3ff7efc">hpd_next_adapter</a>(<a class="code" href="a00020.html#a00112">hpd_adapter_id_t</a> **adapter_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a1cbcbcbc95d12b0038514663b26a5f10">hpd_next_device</a>(<a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **device_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#ae9856eccf954759353ca4f68a1a2839d">hpd_next_service</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a109baeb2fb75c9d1d2ff6506e0176d8e">hpd_adapter_next_device</a>(<a class="code" href="a00020.html#a00114">hpd_device_id_t</a> **device_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#acc19d8881fd760ae0a219a9b70da4eb4">hpd_adapter_next_service</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a928f2263cd4b1d300e9c73936531c544">hpd_device_next_service</a>(<a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service_id);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a79ffb29dcdd02248b02806b84bd137ba">hpd_service_next_parameter</a>(<a class="code" href="a00020.html#a00125">hpd_parameter_id_t</a> **parameter_id);</div>
</div><!-- fragment --><p> In brief: Get functions will navigate upwards in the hierarchy, first functions will get the first object in the list under the given object, next will give the next one.</p>
<p>Because first-next function are a bit complicated to use, the following defines are also available to create simple foreach loops (based on the same principle from libev): </p><div class="fragment"><div class="line"><span class="preprocessor">#define hpd_foreach_adapter(RC, ADAPTER, HPD) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_first_adapter((HPD), &amp;(ADAPTER)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (ADAPTER); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_next_adapter(&amp;(ADAPTER)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_foreach_device(RC, DEVICE, HPD) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_first_device((HPD), &amp;(DEVICE)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (DEVICE); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_next_device(&amp;(DEVICE)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_foreach_service(RC, SERVICE, HPD) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_first_service((HPD), &amp;(SERVICE)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (SERVICE); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_next_service(&amp;(SERVICE)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_adapter_foreach_device(RC, DEVICE, ADAPTER) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_first_device((ADAPTER), &amp;(DEVICE)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (DEVICE); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_next_device(&amp;(DEVICE)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_adapter_foreach_service(RC, SERVICE, ADAPTER) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_first_service((ADAPTER), &amp;(SERVICE)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (SERVICE); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_adapter_next_service(&amp;(SERVICE)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_device_foreach_service(RC, SERVICE, DEVICE) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_device_first_service((DEVICE), &amp;(SERVICE)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (SERVICE); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_device_next_service(&amp;(SERVICE)))</span></div>
<div class="line"><span class="preprocessor">#define hpd_service_foreach_parameter(RC, PARAMETER, SERVICE) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_first_parameter((SERVICE), &amp;(PARAMETER)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PARAMETER); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_service_next_parameter(&amp;(PARAMETER)))</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="sec_comm"></a>
Communication</h1>
<h2><a class="anchor" id="sec_value"></a>
Shared API - Value structure</h2>
<p>The value structure is used in both get and put requests and thus is available for both adapters and applications: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a344d7fd8e951958c7ce52209d60f2ccf">hpd_value_alloc</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> **value, <span class="keyword">const</span> <span class="keywordtype">char</span> *body, <span class="keywordtype">int</span> len);</div>
<div class="line"><span class="comment">// TODO New function, check if it can be used elsewhere</span></div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a0aa34f0ba8202ed0e5d3c71719f658b0">hpd_value_allocf</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> **value, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a572d9ba574dce917be53b2bdf59ea5b6">hpd_value_vallocf</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> **value, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, va_list vp);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a8b5be61f356ac1d72634654e16794610">hpd_value_copy</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> **dst, <span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *src);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a214a6d699e1e5cbff10fa2d6fee721ff">hpd_value_free</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> *value);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a75b6ef13b716e7b51a4a24b0df588e33">hpd_value_set_header</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a2611edcf1f90741780c5160a1e2d622e">hpd_value_set_headers</a>(<a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#af797956501814440a1d9f3110b2b6fba">hpd_value_get_body</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, <span class="keyword">const</span> <span class="keywordtype">char</span> **body, <span class="keywordtype">size_t</span> *len);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#aa4d188fa66bc6544723850a873e9dafc">hpd_value_get_header</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="a00012.html#ad0ed575d03a4dca41d2d38d4fa19a442">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **val);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a161f88ef5d108676829fb2db4b0b939d">hpd_value_get_headers</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, ...);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#affca822619a57bf27e3304e5718375b9">hpd_value_first_header</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value, <a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00075.html#a576a588cbe54bea7b62a992ed557c6b7">hpd_value_next_header</a>(<a class="code" href="a00031.html#a00124">hpd_pair_t</a> **pair);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="preprocessor">#define hpd_value_foreach_header(RC, PAIR, VALUE) for ( \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_value_first_header((VALUE), &amp;(PAIR)); \</span></div>
<div class="line"><span class="preprocessor">    !(RC) &amp;&amp; (PAIR); \</span></div>
<div class="line"><span class="preprocessor">    (RC) = hpd_value_next_header(&amp;(PAIR)))</span></div>
</div><!-- fragment --><p> The body of a value is the actual value, where the headers are additional attributes, which are currently unused but will be used to indicate time-to-live for caching, but are defined generic so they can easily be expanded without breaking the API. Note it is also possible for adapters and applications to store their own custom headers, similar to the principle in HTTP headers.</p>
<p>The len in hpd_value_alloc can be set to HPD_NULL_TERMINATED if body is a \0 terminated string:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define HPD_NULL_TERMINATED -1</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="sec_adapter_comm"></a>
Adapter API - Communication</h2>
<p>Action functions will need functions related to requests/responses to manage these (functions to manage values are shared with applications and will be shown later): </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#aadd680601ef9f0c2364a1aeaced59953">hpd_request_get_service</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00126">hpd_request_t</a> *req, <span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **<span class="keywordtype">id</span>);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a1b0d788115cc35bceceb946f20298955">hpd_request_get_method</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00126">hpd_request_t</a> *req, <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> *method);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a985e1c73f321c64d6a74fb4d1cf8524f">hpd_request_get_value</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00126">hpd_request_t</a> *req, <span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> **value);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#aff4eae061b1220e0bb55de72f8129493">hpd_response_alloc</a>(<a class="code" href="a00033.html#a00127">hpd_response_t</a> **response, <a class="code" href="a00033.html#a00126">hpd_request_t</a> *request, <a class="code" href="a00030.html#a60424f5506ab8db09a11ee78f2f980e6">hpd_status_t</a> status);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a2f50d49e360ca2689857e43bfcd533b3">hpd_response_free</a>(<a class="code" href="a00033.html#a00127">hpd_response_t</a> *response);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a23aa9a2e797738188778c906be59221a">hpd_response_set_value</a>(<a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a0f52d1f4e06fe16eb27a1b394bcd6d86">hpd_respond</a>(<a class="code" href="a00033.html#a00127">hpd_response_t</a> *response);</div>
</div><!-- fragment --><p> And when, we are considering communication, an adapter should call the following function, whenever a service has changed value: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00071.html#a07a10b83cf5554e81e5d80d0dfbe7215">hpd_changed</a>(<span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00033.html#a00133">hpd_value_t</a> *val);</div>
</div><!-- fragment --> <div align="center">
<object type="image/svg+xml" data="inline_umlgraph_6.svg"></object>
<div class="caption">
Lifetime of request/response structures</div>
</div>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_7.svg"></object>
<div class="caption">
Lifetime of request/response structures</div>
</div>
<h2><a class="anchor" id="sec_application_api"></a>
Application API - Communication</h2>
<p>The functions in the Application API are only available for applications.</p>
<p>For hpd_request_t, hpd_response_t and hpd_listener_t functions we need the following callbacks: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="a00030.html#ac82f1adb334b52cc66fa6112d367d07a">hpd_response_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *res);</div>
<div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="a00030.html#a68fdc3cf3d04dc731dda2702445ee878">hpd_value_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *service, <span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> *val);</div>
<div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="a00030.html#a1ccb530f148c41890c45396b906b8b8b">hpd_device_f</a>) (<span class="keywordtype">void</span> *<a class="code" href="a00051.html#a7eeea53acac92b2cc17084963282fc11">data</a>, <span class="keyword">const</span> <a class="code" href="a00020.html#a00114">hpd_device_id_t</a> *device);</div>
</div><!-- fragment --><p> The functions for requests and response are the reverse of an adapter (an application can create requests and read the values of a response): </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#aa6d853067ae916b9213cd0c936c201c2">hpd_request_alloc</a>(<a class="code" href="a00033.html#a00126">hpd_request_t</a> **request, <span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> *<span class="keywordtype">id</span>, <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> method, <a class="code" href="a00030.html#ac82f1adb334b52cc66fa6112d367d07a">hpd_response_f</a> on_response);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a70445c0ba17e60a009c9557ec0dd7d3b">hpd_request_free</a>(<a class="code" href="a00033.html#a00126">hpd_request_t</a> *request);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#af0e001de59db25ddc4a3df544e14c490">hpd_request_set_value</a>(<a class="code" href="a00033.html#a00126">hpd_request_t</a> *request, <a class="code" href="a00033.html#a00133">hpd_value_t</a> *value);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#ac9eeff8f3e494a62942c2ebed8f05cd9">hpd_request_set_data</a>(<a class="code" href="a00033.html#a00126">hpd_request_t</a> *request, <span class="keywordtype">void</span> *data, <a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a> on_free);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a077adc41aa1c0f7270a995ff42420424">hpd_request</a>(<a class="code" href="a00033.html#a00126">hpd_request_t</a> *request);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a1769890612720a141ca4b8e46e6841f9">hpd_response_get_status</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <a class="code" href="a00030.html#a60424f5506ab8db09a11ee78f2f980e6">hpd_status_t</a> *status);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a7c98cef4689f6ba3a7debc96b43a9dac">hpd_response_get_value</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> **value);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#acc5f0ce6e069361330a20015760e5968">hpd_response_get_request_data</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <span class="keywordtype">void</span> **data);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a73a25c0e072cf8a27a18c17c179b4c19">hpd_response_get_request_service</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <span class="keyword">const</span> <a class="code" href="a00020.html#a00130">hpd_service_id_t</a> **service);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#ad1011e309216eeb47ef204a18535d6cf">hpd_response_get_request_method</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <a class="code" href="a00030.html#a48b1bff2ed83cd824c21df91b2d74e01">hpd_method_t</a> *method);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a631ed991bdffb1e1527d5f075ccf2e19">hpd_response_get_request_value</a>(<span class="keyword">const</span> <a class="code" href="a00033.html#a00127">hpd_response_t</a> *response, <span class="keyword">const</span> <a class="code" href="a00033.html#a00133">hpd_value_t</a> **value);</div>
</div><!-- fragment --><p> In addition, an application can also create listeners. Listeners can be created on any object (HomePort, adapter, device, and service) and will be called for that object and everything below if the conditions are met. E.g., a listener with a value callback on an adapter will be called if any service under that adapter changes value. Function to manage listeners: </p><div class="fragment"><div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a49f0552ce2f504f4769612ac6cac6933">hpd_listener_alloc</a>(<a class="code" href="a00028.html">hpd_listener_t</a> **listener, <a class="code" href="a00017.html#a00110">hpd_t</a> *hpd);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a6ed81ad49352be61e2a8710624396e93">hpd_listener_set_data</a>(<a class="code" href="a00028.html">hpd_listener_t</a> *listener, <span class="keywordtype">void</span> *data, <a class="code" href="a00030.html#a48ae026294e911f802713816b5abd57f">hpd_free_f</a> on_free);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#aaf1e38cf565af096ee9baf39f4e6bba8">hpd_listener_set_value_callback</a>(<a class="code" href="a00028.html">hpd_listener_t</a> *listener, <a class="code" href="a00030.html#a68fdc3cf3d04dc731dda2702445ee878">hpd_value_f</a> on_change);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a5b21c4186d69cad1bc1eee041ce4c220">hpd_listener_set_device_callback</a>(<a class="code" href="a00028.html">hpd_listener_t</a> *listener, <a class="code" href="a00030.html#a1ccb530f148c41890c45396b906b8b8b">hpd_device_f</a> on_attach, <a class="code" href="a00030.html#a1ccb530f148c41890c45396b906b8b8b">hpd_device_f</a> on_detach);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#ac154bd8740424c2a5488b54cbd75f524">hpd_subscribe</a>(<a class="code" href="a00028.html">hpd_listener_t</a> *listener);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a96236544de2ed9cacdc03b5dedeb6d4e">hpd_listener_free</a>(<a class="code" href="a00028.html">hpd_listener_t</a> *listener);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a977ca101a6df1484a39eeb195e5a047d">hpd_listener_get_data</a>(<span class="keyword">const</span> <a class="code" href="a00028.html">hpd_listener_t</a> *listener, <span class="keywordtype">void</span> **data);</div>
<div class="line"><a class="code" href="a00030.html#a3f117b297a535788094c22da826c2c94">hpd_error_t</a> <a class="code" href="a00073.html#a3578ba442766650f37f8b769950e63a3">hpd_foreach_attached</a>(<span class="keyword">const</span> <a class="code" href="a00028.html">hpd_listener_t</a> *listener);</div>
</div><!-- fragment --><p> The foreach function will cause the given listener to be called for each device that is already attached.</p>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_8.svg"></object>
<div class="caption">
Lifetime of request/response structures</div>
</div>
<dl class="todo"><dt><b><a class="el" href="a00100.html#_todo000004">Todo:</a></b></dt><dd>Finish listener sequence chart</dd></dl>
<div align="center">
<object type="image/svg+xml" data="inline_umlgraph_9.svg"></object>
<div class="caption">
Lifetime of listener structures</div>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 10 2016 13:43:32 for HomePort by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
